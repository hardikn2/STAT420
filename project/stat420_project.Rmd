---
title: "Data Analysis Project Proposal: Enrollment Rate across US Universities"
output: html_document
---

## Team

- Joseph Juhn (jjuhn2)
- Olga Scrivner (olgas2)
- Hardik Naik (hardikn2)
- Marie Biscarrat (biscarr1)

## Title

A tentitive title for this Data Analysis Project is: 

*Enrollment Rate across US Universities*

## Research Statement

We are looking to study how enrollment rate (Enrollment / Application) across US University is affected by tuition, location, test scores .... This is one of the essential questions asked by not only prospective students (domestic and international) and their parents but also by other stakeholders, for example, school deans, counselors, Standardized Test tutors. We are hoping that with this model, prospective students will have a better idea of their chances to be enrolled in a school based on their high school and test results and other factors that are considered when choosing a school. 

## Data

Our data comes from IPEDS (https://nces.ed.gov/ipeds/use-the-data), a publicly available data by NCES from every Title IV-eligible institution as required by the Higher Education Act of 1965. The data provides characteristics of institutions (Programs, majors, highest level of awards, tuitionâ€¦), students enrollments and admission (SAT, ACT, ethnicity...), completions (race, ethnicity, gender, level of awards, graduation rates...), and other outcomes. The following datasets are extracted for the year 2016: Institutional Characteristic Data, Admission and Test Scores Data, Fall Enrollments. All datasets are linked by Institution ID. For this study the most relevant variables/predictors are (among others): Institution ID, names, states and location type (taken from Instidutional Characteristic data set: hd2016.cvs), 75th percentile SAT and ACT scores (taken from Admission and Test Scores data set: adm2016.cvs), and tuition and other fees (taken from Instidutional Characteristic data set: IC2016_AY.cvs). We will be looking at the enrollment rate given by:
\[\text{Enrollment Rate} = \frac{\text{Enrollment}}{\text{Applications}}\]
(Enrollment and application taken from Admission and Test Scores data set: adm2016.cvs)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
adm_full = read.table("adm2016.csv", header = T, sep = ",")
charact_full = read.table("hd2016.csv", header = T, sep = ",")
tuition_full = read.table("ic2016_ay.csv", header = T, sep = ",")
```

```{r}
ID_adm = adm_full$UNITID
ID_charact = charact_full$UNITID
ID_tuition = tuition_full$UNITID
Common_ID = Reduce(intersect, list(ID_adm,ID_charact,ID_tuition))

adm = adm_full[which(ID_adm %in% Common_ID),]
charact = charact_full[which(ID_charact %in% Common_ID),]
tuition = tuition_full[which(ID_tuition %in% Common_ID),]
```

```{r}
as.numeric.factor  =  function(x) {
    as.numeric(levels(x))[x]}
```

```{r message=FALSE, warning=FALSE}
# Sum of all expected cost: Tuition, Fees, Books, on campus Room and Board, other Expenses
in_cost = as.numeric.factor(tuition$CHG2AY3) + as.numeric.factor(tuition$CHG4AY3) + as.numeric.factor(tuition$CHG5AY3) + as.numeric.factor(tuition$CHG6AY3)
out_cost = as.numeric.factor(tuition$CHG3AY3) + as.numeric.factor(tuition$CHG4AY3) + as.numeric.factor(tuition$CHG5AY3) + as.numeric.factor(tuition$CHG6AY3)

# ratio of in-state to out-state costs
cost_ratio = in_cost / out_cost
# ratio of freshman male to female enrolled 
gender_ratio = adm$ENRLFTM / adm$ENRLFTW
# enrollment rate
rate = adm$ENRLT / adm$APPLCN
```

```{r}
Enrollment_data_full = data.frame(
    School.ID = charact$UNITID,
    School.name = charact$INSTNM,
    Enrollment.rate = rate,
    State = charact$STABBR,
    Location.type.detailed = charact$LOCALE,
    SAT.verb.75 = adm$SATVR75,
    SAT.math.75 = adm$SATMT75,
    ACT.engl.75 = adm$ACTEN75,
    ACT.math.75 = adm$ACTMT75,
    Cost.ratio = cost_ratio,
    Gender.ratio = gender_ratio
)
Enrollment_data_detailed = na.omit(Enrollment_data_full)
```

```{r}
# To group the states into regions and to simplify the Location types to have fewer, more generalized, categorical values
NE.abrv = c("CT","ME","MA","NH","RI","VT","NJ","NY","PA")
MW.abrv = c("IN","IL","MI","OH","WI","IA","KS","MN","MO","NE",
             "ND","SD")
S.abrv = c("DE","DC","FL","GA","MD","NC","SC","VA","WV","AL",
            "KY","MS","TN","AR","LA","OK","TX")
W.abrv = c("AZ","CO","ID","NM","MT","UT","NV","WY","AK","CA",
            "HI","OR","WA")
O.abrv <- c("PR","VI","GU","FM")
region.list = list(
  Northeast = NE.abrv,
  Midwest = MW.abrv,
  South = S.abrv,
  West = W.abrv,
  Other = O.abrv)

City.type = c(11,12,13)
Suburbs.type = c(21,22,23)
Town.type = c(31,32,33)
Rural.type = c(41,42,43)

type.list = list(
  City = City.type,
  Suburs = Suburbs.type,
  Town = Town.type,
  Rural = Rural.type)

Enrollment_data_detailed$Regions = sapply(Enrollment_data_detailed$State, 
                 function(x) names(region.list)[grep(x,region.list)])
Enrollment_data_detailed$Location.type = sapply(Enrollment_data_detailed$Location.type.detailed, 
                 function(x) names(type.list)[grep(x,type.list)])
Enrollment_data_detailed$Regions =  as.factor(Enrollment_data_detailed$Regions)
Enrollment_data_detailed$Location.type = as.factor(Enrollment_data_detailed$Location.type)
```

```{r}
# Remove the variables that were transformed into factor variables
remove = c("State","Location.type.detailed")
Enrollment_data = Enrollment_data_detailed[ , !(names(Enrollment_data_detailed) %in% remove)]
```

```{r}
# When you model make sure to remove School.ID and School.Name
model = lm(Enrollment.Rate ~ (.-School.ID - School.Name -State)^2, data = Enrollment_data)
chosen = step(model, trace = 0)
```

## Reference

National Center for Education Statistics. (1986). IPEDS : Integrated Postsecondary Education Data System : less than two-year institutions. Washington, D.C. :National Center for Education Statistics.
Integrated Postsecondary Education System. [Data Files]. Retrieved from https://nces.ed.gov/ipeds/use-the-data. [Accessed 07/16/18].